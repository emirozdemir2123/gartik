<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gartic Clone</title>
<style>
/* CSS Stilleri (Basit ArayÃ¼z) */
body{font-family:Arial, sans-serif;background:#f4f4f4;margin:0;padding:20px}
.card{background:#fff;padding:20px;border-radius:10px;margin-bottom:20px;box-shadow: 0 4px 8px rgba(0,0,0,0.1);}
button{padding:10px 15px;border:none;border-radius:5px;background:#007bff;color:#fff;cursor:pointer;margin-top:10px;}
button:hover{background:#0056b3;}
input{padding:10px;margin:5px 0;width:calc(100% - 20px);box-sizing:border-box;border:1px solid #ccc;border-radius:5px;}
hr{border:0;border-top:1px solid #eee;margin:20px 0;}
#game{display:none;max-width:800px;margin:0 auto;}
#lobby h2{color:#333;}
#rooms{list-style:none;padding:0;}
#rooms li{padding:10px;background:#f9f9f9;margin-bottom:5px;border-radius:5px;cursor:pointer;}
#rooms li:hover{background:#e9e9e9;}
#c{border:1px solid #ccc;background:#fff;} /* Canvas */
#chat-box{height:200px;overflow-y:scroll;border:1px solid #ccc;padding:10px;margin-top:10px;background:#fefefe;}
</style>
</head>
<body>

<div id="lobby" class="card">
    <h2>ðŸŽ¨ Oda OluÅŸtur</h2>
    <input id="nick" placeholder="Takma Ä°sim" required />
    <input id="room" placeholder="Oda AdÄ±" required />
    <input id="pass" placeholder="Åžifre (Opsiyonel)" type="password" />
    <button onclick="createRoom()">Oda OluÅŸtur</button>
    
    <hr>
    <h3>Mevcut Odalar (TÄ±kla ve KatÄ±l)</h3>
    <p>KatÄ±lmak iÃ§in yukarÄ±ya Takma Ä°sminizi girin.</p>
    <ul id="rooms"></ul>
</div>

<div id="game" class="card">
    <h3 id="info"></h3>
    <p id="timer">SÃ¼re: --</p>
    
    <div id="canvas-area">
        <canvas id="c" width="600" height="400"></canvas>
    </div>

    <div id="chat-box"></div>
    <input id="msg" placeholder="Tahmininizi YazÄ±n / Sohbet Edin" />
    <button onclick="send()">GÃ¶nder</button>
    
    <hr>
    <h4>Puan Tablosu</h4>
    <ul id="leaderboard"></ul>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
// Socket.IO Ä°stemcisi: Render URL'niz otomatik olarak algÄ±lanÄ±r
const s = io();

// DOM Elementleri
const lobby = document.getElementById('lobby');
const game = document.getElementById('game');
const roomsUl = document.getElementById('rooms');
const nickInput = document.getElementById('nick');
const roomInput = document.getElementById('room');
const passInput = document.getElementById('pass');
const msgInput = document.getElementById('msg');
const infoDisplay = document.getElementById('info');
const timerDisplay = document.getElementById('timer');
const chatBox = document.getElementById('chat-box');
const leaderboardUl = document.getElementById('leaderboard');
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');

// --- BUTON Ä°ÅžLEVLERÄ° (OluÅŸtur ve KatÄ±l Ã‡alÄ±ÅŸan KÄ±sÄ±m) ---

function createRoom(){
    if (!nickInput.value || !roomInput.value) {
        alert('LÃ¼tfen Takma Ad ve Oda AdÄ± girin.');
        return;
    }
    // Sunucuya "create room" olayÄ±nÄ± gÃ¶nderir. Sunucu, baÅŸarÄ±lÄ±ysa "join room" olayÄ±nÄ± geri gÃ¶nderir.
    s.emit('create room', {
        room: roomInput.value,
        password: passInput.value,
        nick: nickInput.value
    });
}

function joinRoom(roomName, requiredPassword) {
    if (!nickInput.value) {
        alert('LÃ¼tfen Takma Ad girin.');
        return;
    }
    // Sunucuya "join room" olayÄ±nÄ± gÃ¶nderir.
    s.emit('join room', {
        room: roomName,
        password: requiredPassword || prompt(`LÃ¼tfen ${roomName} odasÄ±nÄ±n ÅŸifresini girin (BoÅŸ ise boÅŸ bÄ±rakÄ±n):`) || '',
        nick: nickInput.value
    });
}

function send(){
    if (msgInput.value.trim() !== '') {
        s.emit('chat', msgInput.value);
        msgInput.value = '';
    }
}


// --- SOCKET.IO SUNUCUDAN GELEN OLAYLAR ---

// Lobi GÃ¼ncellemesi (Mevcut Odalar Listesi)
s.on('lobby update', data => {
    roomsUl.innerHTML = '';
    for(const r in data){
        const li = document.createElement('li');
        const locked = data[r].locked ? ' ðŸ”’' : '';
        li.textContent = `${r}${locked} (${data[r].count}/${data[r].max})`;
        
        // Odaya tÄ±klandÄ±ÄŸÄ±nda katÄ±lma iÅŸlemini baÅŸlat
        li.onclick = () => {
            const password = data[r].locked ? undefined : ''; // Åžifre gerekip gerekmediÄŸini ayarla
            joinRoom(r, password); 
        };
        roomsUl.appendChild(li);
    }
});

// BaÅŸarÄ±lÄ± KatÄ±lÄ±m
s.on('joined', roomName => {
    lobby.style.display = 'none';
    game.style.display = 'block';
    infoDisplay.textContent = `Oda: ${roomName}`;
    chatBox.innerHTML = ''; // Yeni oda iÃ§in sohbeti temizle
    addChatMessage('Sistem', `Odaya baÅŸarÄ±yla katÄ±ldÄ±nÄ±z: ${roomName}`, 'system');
});

// Hata MesajlarÄ±
s.on('error msg', msg => {
    alert(`Hata: ${msg}`);
});

// Sohbet MesajlarÄ±
s.on('chat', m => {
    addChatMessage(m.split(':')[0], m.split(':')[1], 'chat');
});

// Sistem MesajlarÄ±
s.on('system', m => {
    addChatMessage('Sistem', m, 'system');
});

// ZamanlayÄ±cÄ± GÃ¼ncellemesi
s.on('timer update', time => {
    timerDisplay.textContent = `SÃ¼re: ${time} saniye`;
});

// Ã‡izim Durumu GÃ¼ncellemesi (Ã‡izen/Tahmin Eden)
s.on('draw state', data => {
    if (data.isDrawer) {
        infoDisplay.textContent = `Ã‡iziyorsunuz! Kelime: ${data.word}`;
    } else {
        infoDisplay.textContent = `Tahmin Ediyorsunuz! Ã‡izen: ${data.drawer}`;
    }
    // Ã‡izen deÄŸilse tuvali pasifize etme mantÄ±ÄŸÄ± buraya eklenebilir.
});

// Puan Tablosu GÃ¼ncellemesi (Ã‡izim yok, basit bir liste)
s.on('leaderboard update', leaderboard => {
    leaderboardUl.innerHTML = '';
    leaderboard.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p.nickname}: ${p.score}`;
        leaderboardUl.appendChild(li);
    });
});

// Tuvali Temizleme
s.on('clear canvas', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
});

// Helper: Sohbet mesajÄ±nÄ± kutuya ekleme
function addChatMessage(sender, message, type) {
    const p = document.createElement('p');
    p.innerHTML = `<strong>[${sender}]</strong>: ${message}`;
    if (type === 'system') {
        p.style.color = 'blue';
        p.style.fontWeight = 'bold';
    }
    chatBox.appendChild(p);
    chatBox.scrollTop = chatBox.scrollHeight;
}

// Ã‡izim mantÄ±ÄŸÄ± eksik, ancak temel iÅŸlevsellik burada.
    
</script>
</body>
</html>